-- Ensure settings row exists
insert into public.app_settings(id) values (true)
on conflict (id) do nothing;

-- Helper (UI uses; optional server-side enforcement later)
create or replace function public.lead_time_ok(p_date date)
returns boolean language sql stable as $$
  select (select coalesce(lead_time_days, 0) from public.app_settings where id = true) <= (p_date - current_date)
$$;

-- Rep list for Assign dialog
create or replace view public.v_brand_reps as
select m.brand_id, p.id as profile_id, coalesce(p.full_name, p.email) as rep_name
from public.brand_members m
join public.profiles p on p.id = m.profile_id;
